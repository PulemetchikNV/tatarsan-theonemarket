---

description: Работа с БД и Prisma
globs:
  - src/**
alwaysApply: false
---
- Всегда используйте единый экземпляр Prisma-клиента из `src/core/db/client.ts`, не создавайте новые `PrismaClient()` в других файлах.
- В `src/bot/**` доступ к БД допускается только через общий клиент или специализированные сервисы core (никаких прямых импортов `../../prisma/client` с кастомной конфигурацией).
- Операции, которые комбинируют несколько сущностей/таблиц, выносите в сервисный слой core (например, `userService`, `dialogService`), а не держите их внутри handlers.
- Бизнес-правила, связанные с БД (регистрация пользователя, работа с диалогом), формализуйте в core-сервисах, а не в middleware.
- Логику миграций и схему (`prisma/schema.prisma`) рассматривайте как часть core; бот должен быть способен использовать их как “чёрный ящик” через Prisma-сервисы.