import { z } from 'zod';
import { tool } from '@langchain/core/tools';
import { marketResearcherAgent } from '../../marketResearcher/index.js';
import { createModuleLogger } from '../../../../utils/logger.js';

const logger = createModuleLogger('analyzeDashboardTool');

/**
 * Tool –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞—à–±–æ—Ä–¥–∞ —Ä–µ–≥–∏–æ–Ω–∞
 * 
 * –í—ã–∑—ã–≤–∞–µ—Ç MarketResearcherAgent –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ä—ã–Ω–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞
 * –ë–ï–ó –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–æ–º–ø–∞–Ω–∏—è–º
 */
export const analyzeDashboardTool = tool(
  async ({ region }) => {
    const startTime = Date.now();
    
    try {
      logger.info({ region }, 'üìä Starting dashboard market analysis');

      // –í—ã–∑—ã–≤–∞–µ–º marketResearcher –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–≥–∏–æ–Ω–∞
      const data = await marketResearcherAgent.analyzeRegion(region);
      const executionTime = Date.now() - startTime;

      logger.info({ 
        executionTime,
        region,
      }, '‚úÖ Dashboard market analysis completed');

      return `‚úÖ **–ê–ù–ê–õ–ò–ó –î–ê–®–ë–û–†–î–ê –ó–ê–í–ï–†–®–ï–ù**

üìä –†—ã–Ω–æ—á–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞ "${region}" –∑–∞ ${executionTime}ms

–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã –æ—Ç MarketResearcher –∞–≥–µ–Ω—Ç–∞.
–ê–≥–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª tools:
- research_market_from_data_api - –ø–æ–ª—É—á–∏–ª –æ–±—â—É—é –∫–∞—Ä—Ç–∏–Ω—É —Ä—ã–Ω–∫–∞
- get_top_technologies_from_data_api - –ø–æ–ª—É—á–∏–ª —Ç–æ–ø —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –ø–æ —Å–ø—Ä–æ—Å—É

–†–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ—Ç–æ–≤ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞!`;

    } catch (error) {
      const executionTime = Date.now() - startTime;
      logger.error({ err: error, executionTime, region }, '‚ùå Dashboard market analysis failed');

      return `‚ùå **–û–®–ò–ë–ö–ê –ê–ù–ê–õ–ò–ó–ê –î–ê–®–ë–û–†–î–ê**

–†–µ–≥–∏–æ–Ω: ${region}
–û—à–∏–±–∫–∞: ${error instanceof Error ? error.message : 'Unknown error'}

‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ`;
    }
  },
  {
    name: 'analyze_dashboard',
    description: `–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç IT-—Ä—ã–Ω–æ–∫ —Ä–µ–≥–∏–æ–Ω–∞ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞.

–ö–û–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
- –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω—É
- –ë–ï–ó –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–æ–º–ø–∞–Ω–∏—è–º
- –î–ª—è –¥–∞—à–±–æ—Ä–¥–∞ —Å –æ–±—â–µ–π –∫–∞—Ä—Ç–∏–Ω–æ–π —Ä—ã–Ω–∫–∞

–ß–¢–û –î–ï–õ–ê–ï–¢:
- –í—ã–∑—ã–≤–∞–µ—Ç MarketResearcher –∞–≥–µ–Ω—Ç–∞
- –ê–≥–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç data-api tools –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ä—ã–Ω–∫–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–π, –≤–∞–∫–∞–Ω—Å–∏–∏, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —Ç—Ä–µ–Ω–¥—ã

–ü–ê–†–ê–ú–ï–¢–†–´:
- region: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "–¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω")

–í–û–ó–í–†–ê–©–ê–ï–¢:
- –û–±–∑–æ—Ä —Ä—ã–Ω–∫–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–π, –≤–∞–∫–∞–Ω—Å–∏–π)
- –¢–æ–ø —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–π –ø–æ –≤–∞–∫–∞–Ω—Å–∏—è–º
- –¢–æ–ø —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –ø–æ —Å–ø—Ä–æ—Å—É
- –†—ã–Ω–æ—á–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã
- –î–∏–Ω–∞–º–∏–∫—É —Ä—ã–Ω–∫–∞ (—Ä–æ—Å—Ç/—Å–ø–∞–¥)

–í–ê–ñ–ù–û: –≠—Ç–æ –ù–ï –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏! –≠—Ç–æ –∞–Ω–∞–ª–∏–∑ –≤—Å–µ–≥–æ —Ä—ã–Ω–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞!`,
    schema: z.object({
      region: z.string().describe('–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "–¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω")'),
    }),
  }
);

